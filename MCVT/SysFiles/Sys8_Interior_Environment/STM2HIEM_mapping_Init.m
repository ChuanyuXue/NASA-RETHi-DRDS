function [Bmap, Temp2HIEM]=STM2HIEM_mapping_Init
% STM_EN40
IEN_ADJ=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40;7,6,8,9,10,0,0,0,0,0,0,0,0,0,0,13,14,12,11,15,0,0,0,0,0,21,22,23,25,24,0,0,0,0,0,31,32,33,34,35;0,0,0,0,0,2,1,3,4,5,19,18,16,17,20,0,0,0,0,0,26,27,28,30,29,0,0,0,0,0,36,37,38,39,40,0,0,0,0,0;2,1,2,1,1,7,6,6,7,7,12,6,8,11,11,3,16,2,17,17,12,11,15,22,21,18,19,20,26,27,10,7,6,25,31,5,1,2,29,36;4,3,4,3,4,8,9,9,8,9,14,11,12,13,14,17,19,16,18,19,22,21,22,23,24,27,26,27,30,28,32,31,21,33,32,37,36,26,38,37;5,18,16,5,36,12,10,13,10,31,15,13,14,15,23,18,20,19,20,28,25,23,24,25,34,29,28,30,39,29,35,33,32,35,34,40,38,37,40,39;37,38,0,0,0,33,32,0,0,0,22,21,0,0,0,0,0,26,27,0,33,24,0,0,0,38,30,0,0,0,0,35,34,0,0,0,40,39,0,0];
INN=[2,3,5,6,8,10,15,20,25,29,1,1,2,2,3,4,3,5,6,6,7,8,9,11,11,13,14,15,16,17,18,19,21,23,24,25,26,28,29,34,31,36,39,1,1,2,1,1,3,4,6,7,11,11,11,11,13,14,16,17,21,22,21,23,24,26,27,31,32,31,34,36,37,1,1,11,11,22,21,31,32;18,16,36,12,13,31,23,28,34,39,5,2,3,6,4,5,8,10,8,7,10,9,10,15,12,14,15,20,17,20,19,20,25,24,25,29,29,30,30,35,35,40,40,4,2,3,5,2,4,5,7,9,14,12,15,12,14,15,17,19,22,23,25,24,25,27,28,32,33,35,35,37,38,4,2,14,12,23,22,32,33;26,0,0,21,0,0,0,0,0,0,36,37,16,12,0,0,13,31,12,32,31,0,0,22,21,0,0,23,0,0,26,27,33,0,0,34,38,0,0,0,0,0,0,5,3,6,7,6,8,9,8,10,15,13,19,18,16,17,18,20,24,24,26,28,29,29,30,35,34,36,39,40,39,5,3,15,13,24,24,35,34;38,0,0,33,0,0,0,0,0,0,37,38,18,18,0,0,16,36,13,33,32,0,0,23,22,0,0,28,0,0,27,28,34,0,0,39,39,0,0,0,0,0,0,0,4,8,10,7,9,10,9,0,0,14,20,19,17,20,19,0,25,0,29,30,30,30,0,0,35,40,40,0,40,7,4,17,14,27,25,36,35;0,0,0,0,0,0,0,0,0,0,0,0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,31,32,0,0,0,0,0,0,22,21,0,0,0,0,0,0,33,0,0,0,0,0,0,0,0,0,0,9,6,19,16,28,26,37,37;0,0,0,0,0,0,0,0,0,0,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,32,33,0,0,0,0,0,0,23,22,0,0,0,0,0,0,34,0,0,0,0,0,0,0,0,0,0,10,7,20,17,30,27,40,38;0,0,0,0,0,0,0,0,0,0,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,36,37,0,0,0,0,0,0,27,26,0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,8,0,18,0,29,0,39;0,0,0,0,0,0,0,0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,37,38,0,0,0,0,0,0,28,27,0,0,0,0,0,0,39,0,0,0,0,0,0,0,0,0,0,0,9,0,19,0,30,0,40];

% Xex_STM_rot=[0;0;0;0;0;0;0;0;0;-1.03367782000000;-0.947784305000000;-1.00382209000000;-1.08051836000000;-1.10978198000000;-1.08540976000000;-1.00506556000000;-0.947341383000000;-1.03351140000000;-1.73224521000000;-1.53118479000000;-1.76562309000000;-1.97476673000000;-2.05060959000000;-1.97478390000000;-1.76742232000000;-1.53301001000000;-1.73330247000000;-2.22800994000000;-2.55960584000000;-2.67925072000000;-2.55997181000000;-2.22908878000000;1.02138114000000;0.941107690000000;0.999611497000000;1.08273184000000;1.10978198000000;1.06991577000000;0.984814823000000;0.941342354000000;1.02965510000000;1.72727036000000;1.52298975000000;1.75544477000000;1.96738708000000;2.05060959000000;1.97225237000000;1.76380968000000;1.53234744000000;1.73024666000000;2.22304797000000;2.55738950000000;2.67925072000000;2.55933022000000;2.22831011000000];
Xex_STM_rot=[-0.100837029017617;-0.263994769292682;-0.326315480550129;-0.263994769292682;-0.100837029017617;0.100837029017617;0.263994769292682;0.326315480550129;0.263994769292682;0.100837029017617;-0.295639210166371;-0.773993500622734;-0.956708580912725;-0.773993500622734;-0.295639210166371;0.295639210166371;0.773993500622734;0.956708580912725;0.773993500622734;0.295639210166371;-0.470294067709182;-1.23124585397008;-1.52190357252180;-1.23124585397008;-0.470294067709182;0.470294067709182;1.23124585397008;1.52190357252180;1.23124585397008;0.470294067709182;-0.612899161735306;-1.60459083709935;-1.98338335072809;-1.60459083709935;-0.612899161735306;0.612899161735306;1.60459083709935;1.98338335072809;1.60459083709935;0.612899161735306;-0.713736190752923;-1.86858560639203;-2.30969883127822;-1.86858560639203;-0.713736190752923;0.713736190752923;1.86858560639203;2.30969883127822;1.86858560639203;0.713736190752923;-0.765933277875553;-2.00523935459282;-2.47861215343453;-2.00523935459282;-0.765933277875553;0.765933277875553;2.00523935459282;2.47861215343453;2.00523935459282;0.765933277875553];
% Yex_STM_rot=[0.896149278000000;1.70457721000000;2.34614921000000;2.75806379000000;2.90000010000000;2.75806379000000;2.34614921000000;1.70457721000000;0.896149278000000;1.02268374000000;1.70805979000000;2.21846032000000;2.56052566000000;2.67925072000000;2.55656838000000;2.22157574000000;1.70746112000000;1.02254450000000;0.929596126000000;1.50110805000000;1.74531209000000;1.96338022000000;2.05060959000000;1.96498120000000;1.74692738000000;1.50304580000000;0.930108190000000;0.988023102000000;1.07449460000000;1.10978198000000;1.07703972000000;0.988403559000000;1.02138114000000;1.73340523000000;2.23082709000000;2.55897045000000;2.67925072000000;2.56340289000000;2.21486259000000;1.69778323000000;1.01896763000000;0.928950131000000;1.49658537000000;1.73670852000000;1.96886313000000;2.05060959000000;1.96911669000000;1.75848770000000;1.52904570000000;0.938966513000000;0.987637579000000;1.07777727000000;1.10978198000000;1.07997453000000;0.994895399000000];
Yex_STM_rot=[2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.47861215343453;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;2.30969883127822;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.98338335072809;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;1.52190357252180;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.956708580912725;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129;0.326315480550129];
% Zex_STM_rot=[2.75806379000000;2.34614921000000;1.70457721000000;0.896149278000000;2.21867129593410e-31;-0.896149278000000;-1.70457721000000;-2.34614921000000;-2.75806379000000;2.50910902000000;2.14341712000000;1.57504761000000;0.828365028000000;7.39557098644699e-32;-0.834172249000000;-1.56985474000000;-2.14408970000000;-2.50923443000000;2.13194227000000;1.95247221000000;1.49881983000000;0.809589028000000;3.20474742746036e-31;-0.805653274000000;-1.49481189000000;-1.94954705000000;-2.13085938000000;1.57155395000000;0.838975430000000;-1.23259516440783e-32;-0.834583282000000;-1.56978381000000;2.51466918000000;2.12594032000000;1.56018817000000;0.830278277000000;7.39557098644699e-32;-0.833213925000000;-1.59201884000000;-2.15439248000000;-2.51227283000000;-2.13625574000000;-1.96232879000000;-1.52061081000000;-0.814227223000000;3.20474742746036e-31;0.801748335000000;1.48549533000000;1.92974877000000;2.12945724000000;-1.57880640000000;-0.841519654000000;-1.23259516440783e-32;0.832756698000000;1.56678557000000];
Zex_STM_rot=[0.310344464145185;0.191803427062097;0;-0.191803427062097;-0.310344464145185;-0.310344464145185;-0.191803427062097;0;0.191803427062097;0.310344464145185;0.909883930072536;0.562339194602160;0;-0.562339194602160;-0.909883930072536;-0.909883930072536;-0.562339194602160;0;0.562339194602160;0.909883930072536;1.44741630981973;0.894552475339543;0;-0.894552475339543;-1.44741630981973;-1.44741630981973;-0.894552475339543;0;0.894552475339543;1.44741630981973;1.88630966002126;1.16580348320040;0;-1.16580348320040;-1.88630966002126;-1.88630966002126;-1.16580348320040;0;1.16580348320040;1.88630966002126;2.19665412416645;1.35760691026250;0;-1.35760691026250;-2.19665412416645;-2.19665412416645;-1.35760691026250;0;1.35760691026250;2.19665412416645;2.35730023989227;1.45689166994170;0;-1.45689166994170;-2.35730023989227;-2.35730023989227;-1.45689166994170;0;1.45689166994170;2.35730023989227];

Sin_IEN=[1,2,3,4,5,16,17,18,19,20,26,27,28,29,30,36,37,38,39,40;11,1,2,15,3,2,29,1,31,8,1,31,8,10,38,3,11,1,10,42;12,12,13,16,11,13,30,13,32,30,31,32,32,37,39,11,12,12,37,43;44,13,15,44,16,29,59,31,59,32,37,66,38,39,66,42,72,37,43,72;45,45,45,45,44,59,60,59,60,60,66,67,67,66,67,72,73,73,73,73];
Sout_IEN=[6,7,8,9,10,11,12,13,14,15,21,22,23,24,25,31,32,33,34,35;4,20,5,22,6,24,4,5,26,7,4,24,7,34,9,6,20,4,9,40;19,21,19,23,21,25,19,19,27,24,25,25,24,35,33,21,21,20,33,41;20,51,22,51,23,53,25,26,53,27,33,61,34,61,35,41,68,33,40,68;51,52,51,52,52,54,54,54,54,53,61,62,62,62,61,68,69,69,69,69];
Nodes_SMM=[1,0,2.50000000000000,0;2,-2.50000000000000,0,0;3,0,0,-2.50000000000000;4,0,2.90000010000000,0;5,-2.90000010000000,0,0;6,0,0,-2.90000010000000;7,0,0,2.90000010000000;8,0,0,2.50000000000000;9,2.90000010000000,0,0;10,2.50000000000000,0,0;11,0,1.25000000000000,-2.16506362000000;12,0,2.16506362000000,-1.25000000000000;13,-1.76776695000000,1.76776695000000,0;14,0,2.70000005000000,0;15,-2.16506362000000,0,-1.25000000000000;16,-1.25000000000000,0,-2.16506362000000;17,-2.70000005000000,0,0;18,0,0,-2.70000005000000;19,-2.05060959000000,2.05060959000000,0;20,0,2.51147366000000,-1.45000005000000;21,0,1.45000005000000,-2.51147366000000;22,-2.51147366000000,0,-1.45000005000000;23,-1.45000005000000,0,-2.51147366000000;24,0,1.45000005000000,2.51147366000000;25,0,2.51147366000000,1.45000005000000;26,-2.51147366000000,0,1.45000005000000;27,-1.45000005000000,0,2.51147366000000;28,0,0,2.70000005000000;29,-2.16506362000000,0,1.25000000000000;30,-1.25000000000000,0,2.16506362000000;31,0,2.16506362000000,1.25000000000000;32,0,1.25000000000000,2.16506362000000;33,2.05060959000000,2.05060959000000,0;34,1.45000005000000,0,2.51147366000000;35,2.51147366000000,0,1.45000005000000;36,2.70000005000000,0,0;37,1.76776695000000,1.76776695000000,0;38,1.25000000000000,0,2.16506362000000;39,2.16506362000000,0,1.25000000000000;40,2.51147366000000,0,-1.45000005000000;41,1.45000005000000,0,-2.51147366000000;42,1.25000000000000,0,-2.16506362000000;43,2.16506362000000,0,-1.25000000000000;44,-1.17617130000000,1.17617130000000,-1.86634469000000;45,-1.57407033000000,1.57407033000000,-1.13780713000000;46,-1.90918827000000,1.90918827000000,0;47,0,1.35000002000000,-2.33826852000000;48,0,2.34440684000000,-1.35354388000000;49,-2.34440684000000,0,-1.35354388000000;50,-1.35000002000000,0,-2.33826852000000;51,-1.82000351000000,1.82000351000000,-1.33610427000000;52,-1.34140956000000,1.34140956000000,-2.19345403000000;53,-1.36435866000000,1.36435866000000,2.16495991000000;54,-1.82592165000000,1.82592154000000,1.31985629000000;55,0,1.35000002000000,2.33826852000000;56,0,2.34440684000000,1.35354388000000;57,-2.34440684000000,0,1.35354388000000;58,-1.35000002000000,0,2.33826852000000;59,-1.56896853000000,1.56896853000000,1.15181386000000;60,-1.15638793000000,1.15638733000000,1.89090860000000;61,1.82000339000000,1.82000351000000,1.33610427000000;62,1.34140956000000,1.34140968000000,2.19345403000000;63,1.90918827000000,1.90918827000000,0;64,1.35000002000000,0,2.33826852000000;65,2.34440684000000,0,1.35354388000000;66,1.56896853000000,1.56896865000000,1.15181386000000;67,1.15638769000000,1.15638769000000,1.89090860000000;68,1.36435866000000,1.36435866000000,-2.16495991000000;69,1.82592154000000,1.82592165000000,-1.31985629000000;70,1.35000002000000,0,-2.33826852000000;71,2.34440684000000,0,-1.35354388000000;72,1.17617118000000,1.17617130000000,-1.86634469000000;73,1.57407033000000,1.57407045000000,-1.13780713000000;74,-1.23393452000000,1.23393452000000,-2.06029391000000;75,-1.73231626000000,1.73231626000000,-1.13566148000000;76,-1.23393452000000,1.23393452000000,2.06029391000000;77,-1.73231626000000,1.73231626000000,1.13566148000000;78,1.23393452000000,1.23393452000000,2.06029391000000;79,1.73231626000000,1.73231626000000,1.13566148000000;80,1.23393452000000,1.23393452000000,-2.06029391000000;81,1.73231626000000,1.73231626000000,-1.13566148000000];

% HIEM_EN112
Xex_HIEM_unrot = [-1.031321213;-0.374273315;-0.992938884;-0.374180816;-0.372558691;-0.400335357;-0.427111223;-1.000331663;-1.106535197;-1.191996857;-1.70044367;-1.948610396;-1.560300425;-1.771134109;-1.352136761;-1.481280162;1.03456854;0.375939019;0.99351266;0.374227405;1.947061791;1.770781874;1.483332395;1.697034776;1.558642045;1.35183978;0.371551521;0.399117634;0.424516231;0.997977487;1.10331601;1.186484576;-0.425756931;-1.190424413;-0.397799045;-1.104461506;-0.371766724;-1.001441203;-1.700452521;-1.949282765;-1.55997865;-1.769530952;-1.354277894;-1.477576913;-0.373312496;-0.375300467;-1.028932668;-0.996530293;0.372269094;1.030100525;0.374632142;1.000348204;1.481988551;1.771445603;1.948271274;1.361015993;1.5612406;1.696887925;0.424302414;0.399514876;0.373381779;1.186416775;1.105524653;1.005382762];
Yex_HIEM_unrot = [-1.896619544;-2.070022344;-1.730274305;-1.890119806;-1.547566921;-1.007270664;-0.348688915;-1.443086981;-0.954992748;-0.332794987;-0.333890967;-0.350082532;-0.958206302;-1.011868208;-1.448404848;-1.555789769;-1.892578855;-2.068297176;-1.728676528;-1.88969393;-0.348009765;-1.007706851;-1.551385658;-0.332028188;-0.955485739;-1.446375163;-1.548300117;-1.007933728;-0.348882563;-1.443863705;-0.955480106;-0.332794316;0.34933348;0.335112684;1.014144288;0.966822826;1.55975646;1.460714595;0.337151855;0.351754859;0.969804898;1.018518254;1.460975513;1.561668336;2.072217165;1.898076788;1.898441329;1.7394775;2.072217821;1.895183415;1.894294515;1.725711226;1.552737074;1.009884694;0.348793991;1.439209448;0.952546873;0.331675895;0.349101424;1.009676398;1.551737698;0.332365535;0.953730473;1.43986103;];
Zex_HIEM_unrot = [0.378484965;0.378428213;1.006702021;1.041591502;1.490418389;1.773482054;1.947170794;1.365422666;1.563938171;1.698159381;1.188140876;0.424950562;1.108522699;0.40107356;1.00952109;0.375864111;0.379221477;0.378805414;1.00707347;1.04151088;0.426776543;0.402129591;0.376874521;1.191380442;1.111092299;1.011334583;1.48968105;1.77341774;1.948005556;1.36548841;1.565387428;1.700407729;1.94848703;1.698157148;1.769610064;1.555096732;1.475874706;1.343885124;1.186165213;0.423279956;1.097254695;0.395492017;0.98987832;0.368297823;0.373084195;1.026892028;0.3726063;0.988125019;0.373231605;0.375509642;1.031181602;1.001709141;0.374881521;0.402066179;0.427447401;1.008566217;1.110702896;1.192251452;1.949017555;1.772040279;1.482536121;1.700606466;1.564400987;1.362650737];

Nodes=[Xex_HIEM_unrot, Yex_HIEM_unrot, Zex_HIEM_unrot];
RMx=[1 0 0; 0 cos(+90/180*pi) -sin(+90/180*pi); 0 sin(+90/180*pi) cos(+90/180*pi)]; % rotation matrix
Nodes_Rotated=zeros(size(Nodes,1),size(Nodes,2));
for i=1:size(Nodes,1)
    Nodes_Rotated(i,:)=Nodes(i,:)*RMx; % Rotation matrix w.r.t x-axis by Seungwook
end

HIEMxyz=Nodes_Rotated; %Updated rotated XYZ coordinate of HIEM model%
Xex_HIEM_rot=HIEMxyz(:,1);
Yex_HIEM_rot=HIEMxyz(:,2);
Zex_HIEM_rot=HIEMxyz(:,3);

STMxyz = [Xex_STM_rot Yex_STM_rot Zex_STM_rot];
HIEMxyz = [Xex_HIEM_rot Yex_HIEM_rot Zex_HIEM_rot];

%% mapping to HIEM
Temp2HIEM = zeros(size(Xex_HIEM_rot,1),1);

for i=1:size(Xex_HIEM_rot,1) %i=1:19%
    dxyz = nan(size(Xex_STM_rot,1),1);
    for j=1:size(Xex_STM_rot,1) %j=1:60%
        dxyz_Tmp = [HIEMxyz(i,:) ; STMxyz(j,:)];
        dxyz(j,1) = pdist(dxyz_Tmp,'euclidean');
    end
    [a,b] = min(dxyz);
    Bmap(i)=b;
end

end